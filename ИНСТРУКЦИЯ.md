# KP Generator — краткое руководство

Проект целиком находится в одной папке **«КП финал»**: приложение, шаблоны, настройки компаний и эта инструкция.

## Запуск

**Из исходников** — откройте папку «КП финал» в терминале и выполните:
```bash
python -m kp_generator.app
```

**Из .exe:**  
Запустите `KP_Generator.exe`. Рядом с exe можно положить папку `tesseract` с `tesseract.exe` (для распознавания PDF-сканов).

---

## 1. Подготовка шаблонов

### Шаблон DOCX (Word)

- **Реквизиты компании** — в тексте или в таблицах укажите плейсхолдеры:
  - `{{COMPANY_NAME}}` — название
  - `{{INN}}` — ИНН
  - `{{ADDRESS}}` — адрес
  - `{{PHONE}}` — телефон
  - `{{CEO}}` — руководитель  

  Они будут заменены на данные выбранной компании.

- **Таблица товаров:**
  - В первых 5 строках таблицы должны быть **заголовки** колонок. Поддерживаются, например:
    - Наименование / Товар / Услуга
    - Количество / Кол-во
    - Ед. изм. / Единица измерения
    - Цена / Цена за ед.
    - Сумма / Итого
  - Сразу под заголовками — **одна строка-образец** (с любым примером: название, число, единица, цена, сумма). По ней программа клонирует строки для всех позиций.
  - Ниже — при необходимости строки **«Итого»**, **«В т.ч. НДС»**, **«Итого без НДС»** — суммы в них пересчитаются автоматически.

- Форматирование (шрифты, границы, заливки) задаётся в образцовой строке и сохраняется в сгенерированном КП.

### Шаблон Excel (если не используете DOCX)

- В шаблоне те же плейсхолдеры реквизитов: `{{COMPANY_NAME}}`, `{{INN}}`, `{{ADDRESS}}`, `{{PHONE}}`, `{{CEO}}`.
- Таблица с заголовками: **Наименование**, **Количество**, **Ед. изм.**, **Цена**, **Сумма** (или близкие по смыслу). Под заголовками — строки товаров; программа подставит новые данные и обновит итог.

### Примеры шаблонов

- В папке **`kp_generator/assets/templates/`** лежат примеры:
  - **template_kp.docx** — шаблон Word (плейсхолдеры реквизитов, таблица с заголовками, строка-образец, итого);
  - **template_kp.xlsx** — шаблон Excel.
- Их можно использовать как есть или скопировать и отредактировать под себя. При первом запуске шаблоны создаются командой:  
  `python -m kp_generator.create_templates`

### Файл компаний

- В папке `kp_generator/assets/` лежит `companies.json` со списком компаний (название, ИНН, адрес, телефон, руководитель).  
- Можно править его вручную или добавлять новые компании по тому же формату.

---

## 2. Работа в программе

1. **Исходный файл**  
   Нажмите «Выбрать PDF/Excel» и укажите файл с позициями (таблица в Excel или PDF с таблицей/сканом).

2. **Шаблон DOCX (по желанию)**  
   Если нужен вывод в Word — нажмите «Выбрать DOCX» и укажите подготовленный шаблон.  
   Если DOCX не выбран, КП будет сформировано в Excel (по шаблону Excel или по умолчанию).

3. **Варианты КП (2–3)**  
   Включите минимум 2 варианта. Для каждого укажите:
   - компанию из списка;
   - наценку **%**;
   - фиксированную надбавку **+руб**;
   - случайный разброс **±руб** (опционально);
   - шаг округления цены: **1**, **10**, **50** или **100**.

4. **Папка вывода**  
   Укажите папку, куда сохранять готовые файлы (по умолчанию — «Документы / KP_Generator_Output»).

5. **Сгенерировать**  
   Нажмите «Сгенерировать». В логе отобразится ход работы и пути к сохранённым файлам.

---

## 3. Результаты

- Файлы сохраняются с именами вида:  
  `КП_<Компания>_<дата-время>_v1.docx` (или `.xlsx`).  
  Дата-время в имени исключает перезапись при повторной генерации в тот же день.

- Логи работы программы пишутся в ту же папку вывода (подпапка с логами или тот же каталог — в зависимости от версии). В окне программы лог выводится в текстовое поле «Лог».

---

## 4. Частые проблемы

- **«Не удалось извлечь товары»** — проверьте, что в исходном Excel/PDF есть таблица с заголовками вроде «Наименование», «Количество», «Цена» (или синонимы). Для PDF-скана нужен установленный Tesseract (см. `TESSERACT_README.txt`).
- **«Некорректный JSON» / «отсутствуют ключи»** — проверьте `assets/companies.json`: все компании должны содержать поля `id`, `name`, `inn`, `address`, `phone`, `ceo`.
- **Отрицательные значения** в полях наценки/надбавки/разброса не допускаются — программа выдаст ошибку с указанием варианта.
- **Файлы .doc** не поддерживаются — сохраните шаблон в Word как **.docx** и выберите его.

---

## 5. Сборка в один .exe (для разработчика)

Установите зависимости и PyInstaller. Все команды выполняйте **из папки «КП финал»** (корень проекта):
```bash
pip install -r requirements.txt
pip install pyinstaller
```

**Windows (CMD):**
```cmd
pyinstaller --noconfirm --onefile --windowed --name "KP_Generator" --add-data "kp_generator/assets;kp_generator/assets" --hidden-import "pytesseract" --hidden-import "openpyxl" --hidden-import "docx" --hidden-import "PIL" --hidden-import "fitz" kp_generator/app.py
```

**Windows (PowerShell):** в `--add-data` используйте точку с запятой: `kp_generator/assets;kp_generator/assets`.

После сборки exe будет в папке `dist/`. Рядом с exe можно положить папку `tesseract` с `tesseract.exe` и `tessdata` для распознавания PDF-сканов.
